# Helm Chart для веб-приложения в Kubernetes

Этот Helm чарт предназначен для развертывания веб-приложения в Kubernetes с учетом требований высокой доступности, отказоустойчивости и оптимизации ресурсов.

## Особенности реализации

### Отказоустойчивость

1. **Распределение подов по зонам**
   - Используется `topologySpreadConstraints` для равномерного распределения подов по трем зонам кластера
   - Это обеспечивает устойчивость к отказу целой зоны

2. **Pod Anti-Affinity**
   - Настроен `podAntiAffinity` для распределения подов по разным нодам
   - Предотвращает размещение нескольких подов на одной ноде

3. **Pod Disruption Budget (PDB)**
   - Гарантирует минимальное количество доступных подов во время обслуживания кластера
   - Предотвращает одновременное удаление слишком большого количества подов

4. **Стратегия обновления**
   - Используется `RollingUpdate` с `maxUnavailable: 0` и `maxSurge: 1`
   - Обеспечивает обновление без простоя (zero-downtime deployment)

### Оптимизация ресурсов

1. **Горизонтальное автомасштабирование (HPA)**
   - Автоматически регулирует количество подов в зависимости от нагрузки
   - Настроено поведение масштабирования для предотвращения частых колебаний

2. **Вертикальное автомасштабирование (VPA)**
   - Оптимизирует запрашиваемые ресурсы для подов
   - Учитывает особенности потребления ресурсов приложением (высокое потребление CPU при старте)

3. **Масштабирование по расписанию**
   - CronJob для уменьшения количества подов ночью
   - CronJob для увеличения количества подов днем
   - Учитывает дневной цикл нагрузки

4. **Настройка проб**
   - `startupProbe` учитывает время инициализации приложения (5-10 секунд)
   - `readinessProbe` и `livenessProbe` для контроля состояния приложения

## Использование

### Установка чарта

```bash
helm install webapp ./webapp-chart
```

### Настройка параметров

Основные параметры можно настроить через файл `values.yaml` или передать при установке:

```bash
helm install webapp ./webapp-chart --set replicaCount.min=6 --set resources.requests.cpu=400m
```

### Важные параметры

- `replicaCount.min` и `replicaCount.max` - минимальное и максимальное количество подов
- `resources.requests` и `resources.limits` - запрашиваемые и максимальные ресурсы
- `autoscaling.enabled` - включение/выключение автомасштабирования
- `scheduleScaling.enabled` - включение/выключение масштабирования по расписанию
- `verticalPodAutoscaler.enabled` - включение/выключение вертикального автомасштабирования

## Принятые решения

1. **Минимальное количество подов: 4**
   - Основано на результатах нагрузочного тестирования, показавшего, что 4 пода справляются с пиковой нагрузкой

2. **Запрашиваемые ресурсы: CPU 300m, Memory 128Mi**
   - Учитывает повышенное потребление CPU при старте (первые запросы)
   - Учитывает стабильное потребление памяти около 128Mi

3. **Вертикальное автомасштабирование**
   - Позволяет динамически регулировать запрашиваемые ресурсы
   - Особенно полезно для оптимизации CPU, который имеет пиковое потребление при старте

4. **Масштабирование по расписанию**
   - Учитывает дневной цикл нагрузки (меньше запросов ночью, пик днем)
   - Позволяет экономить ресурсы кластера в периоды низкой нагрузки

5. **Распределение по зонам**
   - Максимально использует мультизональность кластера (три зоны)
   - Обеспечивает устойчивость к отказу целой зоны